# Render Deployment Guide - Combined Frontend & Backend

This guide explains how to deploy the Fruit Order System on Render using a combined deployment approach (single Web Service).

## Deployment Configuration

### Service Settings

| Setting | Value | Description |
|--------|-----|------|
| **Name** | `fruit-order-system` | Service name (customizable) |
| **Region** | `Singapore` | Choose the nearest region |
| **Branch** | `main` or `master` | Your main branch name |
| **Root Directory** | (leave empty) | ⚠️ **Important**: Must be empty, use root directory |
| **Runtime** | `Node` | Auto-detected |
| **Build Command** | `node build.js` | Build frontend and backend |
| **Start Command** | `cd js_server && npm start` | Start backend server |
| **Instance Type** | `Free` | Free plan |

### Required Environment Variables

Add the following environment variables in "Environment Variables" section:

| Variable Name | Value | Description |
|--------|-----|------|
| `ATLAS_URL` | `mongodb+srv://username:password@cluster.mongodb.net/` | MongoDB connection string (replace with actual value) |
| `NODE_ENV` | `production` | Production environment identifier |
| `SERVE_FRONTEND` | `true` | ⚠️ **Required**: Enable frontend serving |
| `PORT` | `10000` | Render auto-sets this, but can be explicitly specified |
| `REACT_APP_API_URL` | (leave empty or set to relative path) | Frontend API URL (can be empty for combined deployment, uses relative path) |
| `REACT_APP_GOOGLE_CLIENT_ID` | `your-google-client-id` | ⚠️ **Google OAuth frontend Client ID** (must match `GOOGLE_CLIENT_ID`) |
| `GOOGLE_CLIENT_ID` | `your-google-client-id` | ⚠️ **Google OAuth backend Client ID** (must match `REACT_APP_GOOGLE_CLIENT_ID`) |

⚠️ **Important Notes**:
- `SERVE_FRONTEND=true` **must be set**, otherwise backend won't serve frontend files
- `REACT_APP_API_URL` can be left empty for combined deployment since frontend and backend are on the same domain
- **Google OAuth Configuration**: If using Google login, both `REACT_APP_GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_ID` must be set, and **their values must be identical**. Both should be set to the same Google OAuth Client ID.

## Google OAuth Client ID Setup

### Step 1: Create Google Cloud Project

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Click project selector → "New Project"
3. Enter project name (e.g., `fruit-order-system`)
4. Click "Create"

### Step 2: Enable Google Identity Services API

1. Navigate to "APIs & Services" → "Library"
2. Search for "Google Identity Services API"
3. Click and enable the API

### Step 3: Create OAuth 2.0 Client ID

1. **Navigate to Credentials**:
   - Use search bar: type "Credentials" or "憑證"
   - Or: "APIs & Services" → "Credentials"

2. **Create OAuth Client ID**:
   - Click "+ CREATE CREDENTIALS" → "OAuth client ID"
   - Configure OAuth consent screen (if first time):
     - Select "External"
     - Fill in app name and support email
     - Click through the steps
   - Application type: Select "Web application"
   - Name: Enter a name (e.g., `Fruit Order System Web Client`)

3. **Configure Authorized JavaScript origins**:
   - Click "+ Add URI"
   - Add the following URLs:
     ```
     http://localhost:3000
     http://localhost
     https://fruit-order-system-1.onrender.com
     ```

4. **Create and Copy Client ID**:
   - Click "Create"
   - Copy the **Client ID** (format: `123456789-abcdefghijklmnop.apps.googleusercontent.com`)
   - This is the value to set in environment variables

## Deployment Steps

1. **Create Web Service**:
   - Log in to [render.com](https://render.com)
   - Click "New +" → "Web Service"
   - Connect your GitHub repository

2. **Configure Settings**:
   - Use the settings from the table above
   - ⚠️ **Root Directory must be empty**

3. **Set Environment Variables**:
   - Add all required environment variables from the table above

4. **Deploy**:
   - Click "Create Web Service"
   - Wait for build to complete (5-10 minutes for first deployment)

## Verification

1. **Test Backend API**:
   - Visit: `https://your-service-url.onrender.com/api/health`
   - Should see: `{"status":"ok","time":"..."}`

2. **Test Frontend**:
   - Visit: `https://your-service-url.onrender.com`
   - Should see the frontend application

## Important Notes

- **Free Plan Limitations**:
  - Service sleeps after 15 minutes of inactivity
  - First request after sleep takes 15-30 seconds to wake up
  - Build time limits apply

- **Root Directory**: Must be empty for the build script to work correctly

- **Google OAuth**: Both `REACT_APP_GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_ID` must be set with the same value
